---
hip: 583
title: Expand alias support in CryptoCreate & CryptoTransfer Transactions
author: Nana Essilfie-Conduah <@Nana-EC>
working-group: Danno Ferrin <@shemnon>, Atul Mahamuni <@atul-hedera>, Richard Bair <@rbair23>,
               Ali Katamjani <ali@swirldslabs.com>, Michael Tinker <@tinker-michaelj>, Mohsin Qamar <@mohsin-hedera>,
               Leemon Baird <@lbaird>
type: Standards Track
category: Service
needs-council-approval: Yes
status: Accepted
last-call-date-time: 2022-10-17T07:00:00Z
created: 2022-09-20
discussions-to: https://github.com/hashgraph/hedera-improvement-proposal/discussions/593
updated: 2022-09-29, 2022-10-03, 2022-10-20, 2022-11-11, 2023-02-07
requires: 32
---

## Abstract

Formalize support for an ECDSA-derived `alias`, and permit all accounts to be created with an `alias`.

## Motivation

Each account has a system-assigned account ID of the form `shard.realm.num`, where each value is an 8-byte number.
[HIP 32](https://hips.hedera.com/hip/hip-32) defines a flow where, when transferring HBAR to an account, the "sender"
can send to an `alias` for the account instead of the account number, where the `alias` is an encoding of the public
key of the account. If there is an account with that `alias`, then the transfer succeeds. If the account does not exist,
then it will be auto-created with the public key of the account matching that of the `alias` and the transfer succeeds.

With [HIP 482](https://hips.hedera.com/hip/hip-482), Hedera now supports an integration path with Ethereum-native
wallets, where those wallets can talk with the JSON-RPC Relay, which talks to the Hedera network. These wallets work
under the assumption that all accounts are derived from an `ECDSA secp256k1` public key. Transferring HBAR from one
account to another involves a crypto transfer from one derived account address to another. However, accounts in Hedera
are quite different! This HIP allows _any_ account on Hedera to have an `ECDSA` derived `alias`, compatible with
Ethereum addresses, and permits the use of this `alias` for all operations supported by `alias` today. This new
capability would allow an account with, for example, a threshold key to have an `ECDSA` derived alias such that
a MetaMask user could transfer funds to that account.

This HIP expands support in the auto-create flow for `ECDSA` derived addresses to be used as the `alias`. It also
adds support to `CryptoCreate` transactions for creation with either a key-based `alias` or, an `ECDSA` derived
`alias`.

## Rationale

Fundamental in the design of the Hedera network are the concepts of _accounts_, account _identifiers_, and _keys_. These
are fundamentally different entities. An `Account` must have a key. The key for the account may be a simple key
(typically, an `ED25519` public key), or it may be a compound key, such as a list of keys all of which must sign each
transaction, or a threshold key such that N of the keys must be signed. These may be nested to create very rich and
powerful accounts requiring multiple-signatures. Further, an `Account` may change the keys on the account over time.

An `Account` also has a system-assigned account identifier of the form `shard.realm.num`, where each value is an 8-byte
number. It may also be referred to with an identifier of the form `shard.realm.alias`, where the alias is of one of
the following forms:

1. `long-zero alias` - This is the Hedera account number styled as an Ethereum account hex string. The
   Hedera account number is hex encoded and the value is prefixed with zeros to form a 20 byte address. This format
   cannot be used to auto-create an account, but can be used wherever an `alias` can be used.
2. `key alias` - This format is created by using the bytes of a simple cryptographic public key supported by Hedera
   (such as `ED25519` or `ECDSA secp256k1`). It is not necessary for the account's key to match the `alias`, only that
   the account owner has asserted cryptographic proof of ownership of the account `alias` key.
3. `evm address alias` - This format is created by using the rightmost 20 bytes of the 32 byte `Keccak-256` hash of a
   `ECDSA secp256k1` public key. This calculation is in the manner described by the Ethereum Yellow Paper.
   Note, that the recovery id is not formally part of the public key and not included in the hash. This is
   calculated on the consensus nodes using the `ECDSA` key provided in the auto create `CryptoTransfer` transaction.

Examples of each format are noted below:
(Please NOTE: the `alias` is a binary format when encoded on-wire for protobuf. We represent the bytes as base-32
encoded ASCII for clarity in the documentation, but in reality these are raw bytes)

| Identifier Type                | Example                                                      |
|--------------------------------|--------------------------------------------------------------|
| Hedera Account ID              | 0.0.10                                                       |
| Hedera Account Long-Zero Alias | 0.0.000000000000000000000000000000000000000a                 |
| Hedera Key Alias               | 0.0.CIQNOWUYAGBLCCVX2VF75U6JMQDTUDXBOLZ5VJRDEWXQEGTI64DVCGQ  |
| EVM Address Alias              | 0.0.b794f5ea0ba39494ce839613fffba74279579268                 |

TODO: Are all three of these base-32 encoded? Should use consistent encoding

To provide greater context for this HIP some additional terms useful:

- `Ethereum-native wallets` - wallets that utilize the Ethereum JSON-RPC APIs implemented by the JSON-RPC Relay.
  Accounts created via these wallets are `ECDSA` derived keys and use the `evm address alias` format.
- `Hedera-native wallets` - wallets that utilize the Hedera SDK or gRPC HAPI calls to interact with Hedera consensus
  and mirror nodes. Historically, accounts created via these wallets are `ED25519` based and usually identify the
  account via the `Hedera Account Id`.
- `Hollow account` - a partially created account which lacks a public key but does have a valid `shard.realm.num`
  accountId _and_ is auto-created with an `evm address alias`. Such an account may receive assets but may not take
  part in transactions that require its signature, until it is promoted to being a "full" account.
- `auto-create` - an account creation flow in which the `key alias` or `evm address alias` that a crypto-transfer
  is addressed to is used to automatically create a new account (if none exists) without an explicit `CryptoCreate`
  transaction being submitted. We call it `hollow-create` when the `evm address alias` is used, since it results
  in the creation of a `Hollow account`.

With an Ethereum-native wallet, you can transfer the native currency (in our case, HBAR), or tokens, to an `evm address`
that does not yet exist. If nobody in the universe has the private key for that account, the value held by that account
is effectively locked forever. If somebody does have the keys to that account, they can access the account and control
it. Since Ethereum-native wallets do not understand the `0.0.10` style format of a Hedera account ID, it is necessary
to support the creation of accounts with an `evm address alias` to enable compatibility between Ethereum-native
wallets and Hedera-native wallets and all accounts.

## User stories

1. As a user with an `ECDSA` derived account from another chain, I would like to create my Hedera account using that
   same ECDSA public key and associated Ethereum compatible `evm address alias`.
2. As a developer, I would like to create a new account with a `key alias` via the `CryptoCreate` transaction.
3. As a developer, I would like to create a new account with an `evm address alias` via the `CryptoCreate` transaction.
4. As a developer, I would like to transfer HBAR or tokens to a Hedera account using their `evm address alias`.
5. As a Hedera user with an `Ethereum-native wallet`, I would like to receive HBAR or tokens in my account by sharing
   only my `evm address alias`.
6. As a Hedera user with a `Hedera-native wallet`,  I would like to transfer HBAR or tokens to another account using
   only the recipient's `evm address alias`.
7. As a Hedera user with an `ED25519` key on my account, I want to add an `evm address alias` to my account.

## Specification

This HIP proposes an expansion to the ways in which an account with an `alias` can be created and referenced to ensure
compatibility with users coming from existing chains with `ECDSA` keys.

It is thus proposed to:
- Update `CryptoCreate` transactions to support setting an alias using an `evm address alias`
- Update `CryptoCreate` transactions to support setting an alias using a `key alias`
- Update `CryptoTransfer` transactions to support auto-account creation for accounts with an `evm address alias`
- Update `CryptoUpdate` transactions to support setting an alias using an `evm address alias`

### Setting `alias` with `CryptoCreate`

#### Modification to `CryptoCreateTransactionBody`

![auto-create-with-key.png](../assets/hip-583/auto-create-with-key.png)

Add the `alias` property to the `CryptoCreateTransactionBody` [proto file](https://github.com/hashgraph/hedera-protobufs/blob/main/services/crypto_create.proto)

```proto
message CryptoCreateTransactionBody {
	...
	/**
     * The bytes to be used as the account's alias. The bytes must be formatted in one of the following ways:
     * 
     * 1. It will be the serialization of a protobuf Key message for an ED25519/ECDSA primitive key type</li>
     * 2. If the key is ECDSA based it may also be formatted as an EVM address, calcluated as the last 20 bytes of the
     *    keccak-256 of the ECDSA primitive key.</li>
     *
     * All other types of keys, including but not limited to ThresholdKey, KeyList, ContractID, and
     * delegatable_contract_id, are not supported.
     *
     * At most only one account can ever have a given alias on the network.
     */
	bytes alias = 18;
}
```

#### Add Public key → alias validation

If the `alias` is set during `CryptoCreate`, then ownership of the `alias` **must** be proven by the caller
by signing the transaction with the key represented by the `alias`. It is not necessary for the `key` on the
newly created account to match the alias, but it **is** necessary for the transaction to be signed by the key
represented by the `alias`.

### `CryptoTransfer` to an `evm account alias`

TODO: Image needs to be updated
![lazy-create-with-address.png](../assets/hip-583/lazy-create-with-address.png)

When a user transfers value (hbars or tokens), they may address their destination account using the standard
account ID format (`shard.realm.num`), or by using an alias format (`shard.realm.alias`). If the alias is an
`evm address alias`, then the consensus node will first check to see if such an account exists. If it does,
then it will use the normal rules for transferring the hbars or tokens (including checking `receiverSigRequired`,
and all other rules). If the account *does not* exist, then the account will be auto-created with the same rules
specified in `HIP-32`, except that no key will be present on the newly created account. An account created in this
manner will be known as a `Hollow Account` and will only be able to receive HBAR and applicable token transfers, but
cannot take part in transactions submitted by others requiring its signature.

Since Hedera accounts require keys to ensure security, an `ECDSA` key matching the derived `evm address alias` must be
provided in a future signed transaction issued by the owner of the account to take control of the account. Due to the
nature of `ECDSA secp256k1` keys, the public key can be extracted from the signature and the signed bytes. It can then
go through the derivation function to generate the associated `evm address`, which can be compared with the `alias` to
prove the match and account ownership. This process will complete the creation of the account, taking it from a
`Hollow Account` to a normal complete account with a valid public key.

Note, in this case the final value of the account alias will remain as the `evm address alias` and not the `key alias`.

`EthereumTransaction` transactions where value is transferred  (i.e `tx.to` and `tx.value` are set) should also support
this case. This will support users of `Ethereum-native wallets` and eth dev tools who are accustomed to creating and
crediting an account's balance in one step. In this case th `tx.to` value of the RLP encoded transaction would dictate
the `evm address alias` to be used.

### Setting `alias` with `CryptoUpdate`

`HIP-32` supports updating the `alias` of an account after the account has been created. This HIP extends that
support to include `evm address alias`es. As with `CryptoCreate`, ownership of the private key of the `ECDSA` public
key associated with the `evm address` **must** be asserted on the `CryptoUpdate` by signing the transaction with
that private key. The key used does **not** have to be in state on any account.

## Backwards Compatibility

Existing accounts are unaffected by the expansion and the additional alias field on the transaction protobuf is already
supported.

`CryptoTransfer` auto-account creation is un-impacted and will still support the provision of the public key. 

### Mirror Node Implications

The Mirror Node can already ingest account creation transactions with alias values. This will only increase the
applicable parent transactions that can cause this flow. Where it was limited to CryptoTransfer it will now include
CryptoCreate, and in both cases it will now support `evm address` formatted aliases.

### Wallet/Exchange Implications

With the suggested changes, the alias property of an account will become more applicable and will need greater
visibility.

To provide greater web3 user scenario support Wallets & Exchanges should:

- Display the account alias property of an account
- Create an ECDSA based account with alias when full smart contract support is desired
- Accept the use of an alias as an account identifier in HBAR and token transfers
- Accept the use of an alias during account creation
- Add support to check if an account exists with a given alias

### Performance Implications

`CryptoCreate` transactions will see extra bytes for every account created with an alias.

The size of the bytes in each case depends on the governing account key type. For an `ECDSA` based account the alias
will always be a valid Ethereum address and will be 20 bytes long. In the `ED25519` case the alias will be a valid
protobuf serialized public key of 35 or 68 bytes depending on encoding.

## Security Implications

The `hollow-create` account flow requires additional checks be added to ensure transactions involving an account with
only an `alias` and no key (i.e. Hollow accounts) are not processed. 

## How to Teach This

- Additional documentation on protobufs
- SDK examples should be written to highlight
    - `CryptoCreate` alias setting using an `evm address alias`
    - `CryptoCreate` alias setting using a `key alias`
    - `CryptoTransfer` alias setting using an `evm address alias`
- Doc site tutorials utilizing SDKs should be written to highlight alias setting and the hollow account creation flow.

## Reference Implementation

The reference implementation must be complete before any HIP is given the status of “Final”. The final implementation
must include test code and documentation.

## Rejected Ideas

- A special reserved `ECDSA` based `aliasKey` on all accounts. This would have ensured only a single key was used on
  contract interactions.
- A special reserved `ECDSA` based `aliasKey` and an additional `evmAlias`. This would have provided complete separation
  of all EVM interactions with Hedera account keys.
- The ability to call `CryptoCreate` with just the `evm address alias` and not the public key. Use a `CryptoTransfer`
  to auto-create without a key, otherwise, supply the key. This feature is not harmful, but not useful either.
- The network automatically setting the alias if the key on the account is an `ECDSA` key. Since an account can have
  only one alias, this choice should be in the hands of the user.

## Open Issues

- For an account created via the `hollow-create` flow, should query calls to a network node result in the key extraction
  and mapping via a child `CryptoUpdate` transaction?

## References

- [Auto Account Creation](https://hips.hedera.com/HIP/hip-32.html)
- [ECRECOVER Precompiled Contract](https://ethereum.github.io/execution-specs/autoapi/ethereum/frontier/vm/precompiled_contracts/ecrecover/index.html)
- [Ethereum Yellow Paper](https://ethereum.github.io/yellowpaper/paper.pdf)

## Copyright/license

This document is licensed under the Apache License, Version 2.0 – see [LICENSE](https://hips.hedera.com/LICENSE) or (https://www.apache.org/licenses/LICENSE-2.0)
